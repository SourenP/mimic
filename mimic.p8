pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

-- globals 
player_spr = 3
actors = {}

function make_actor(x, y, spr_n)
    a={}
    a.x = x
    a.y = y
    a.dx = 0
    a.dy = 0
    a.spr = spr_n

    -- animation
    a.frame = 0
    a.t = 0
    a.frames = 2
    a.flip_x = false

    add(actors, a)
    return a
end

function valid_position(x, y, a)
    if x < 0 or x > 15 or y < 0 or y > 15 then
        return false
    else
        -- todo: add collision check
        return true
    end
end

function move_actor(a)
    if valid_position(a.x + a.dx, a.y + a.dy) then
        a.x += a.dx
        a.y += a.dy
    end

    -- animation
    if a.dx ~= 0 or a.dy ~= 0 then
        a.frame += 1
        a.frame %= a.frames
        a.flip_x = a.dx > 0
    end

    a.dx = 0
    a.dy = 0

end

function draw_actor(a)
    spr(a.spr + a.frame, a.x*8, a.y*8, 1, 1, a.flip_x)
end

function player_input()
    if (btnp(0)) pl.dx = -1
    if (btnp(1)) pl.dx = 1
    if (btnp(2)) pl.dy = -1
    if (btnp(3)) pl.dy = 1
end

function find_player(spr_n)
    for i=0,16 do
		for j=0,16 do
			if mget(i,j) == spr_n then
                -- todo: erase player from map if possible
                -- or find another solution for agent positions
                -- maybe a second layer of the map or define in code?
				return i, j
			end
		end
	end
end

function _init()
	local x, y = find_player(player_spr)
    pl = make_actor(x, y, player_spr)
end

function _update()
    player_input()
    foreach(actors, move_actor)
end

function _draw()
    cls()
    map(0,0,0,0,16,16)
    foreach(actors, draw_actor)
end

__gfx__
00000000000000000000000000000000000000000000b00b00b0000b00000000000000000000000000000000cccccccccccccccc000000000000000000000000
00000000080800000000a0000888888008888880000033300003333000099000009990000003300000000000cccc77ccccccc77c000000000000000000000000
0070070088888000000aa900080808800888888000033933003393330099990909999909000b300000055500c77cccc7c7cc7ccc000000000000000000000000
000770008888800000aaa99008888880080808800bb33393bb33393309d999999d99999900333300005565007cc7cc7ccc77cccc000000000000000000000000
00077000088800000009990008888880088888800bb33393bb333933099999999999999900333b0005555550cccc77cccccccccc000000000000000000000000
00700700008000000000900008888880088888800003393300339333009999090999990903b3333005555650c7cccccccccc77c7000000000000000000000000
0000000000000000000000000888888008888880000033300003333000099000009990000333333005655555cc7cc77c77cccc7c000000000000000000000000
00000000000000000000000000000000000000000000b00b00b0000b00000000000000000004400005555555cccccccccccccccc000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000ee0000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd00000000000000000000000000000000e0000ee00e00e00e000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000e00e00ee0000ee0000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd0000000000000000000000000000000000ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909000000000002000000000000090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909000000000000000015000000090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0b0b0c0b0c0b0c0b0c0c0b0c0c0b0b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909000000000000000000000009090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
090a0a0a000000000000000000090a0900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
090a0a0000000000000000000009090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0900000300000500000007000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0900000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0900000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0900000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0900000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0900000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0900000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0900000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
